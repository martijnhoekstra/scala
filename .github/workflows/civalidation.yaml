name: CI validation 2.13.x

on:
  pull_request:
    branches:
    - actionsExperiments
  push:
    branches:
    - actionsExperiments

jobs:
  bootstrap-test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
        #, windows-latest, macOS-latest]
    
    steps:
    - uses: actions/checkout@v1
    - name: publish non-bootstrapped using STARR
      run: sbt -warn setupPublishCore generateBuildCharacterPropertiesFile headerCheck publishLocal
    - name: build and test bootstrapped
      run: |
        STARR=`cat buildcharacter.properties | grep ^maven.version.number | cut -d= -f2` && echo $STARR
        sbt -Dstarr.version=$STARR -warn setupValidateTest test:compile info testAll
      
  compile-library-with-dotty:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Compile library with Dotty
      run: sbt -Dscala.build.compileWithDotty=true library/compile
